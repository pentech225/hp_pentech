# GoogleカレンダーAPIの使い方（簡易版）

## 現在の設定状況

✅ **既に設定済み:**
- API Key: `AIzaSyCk05BaK1CeOJByKFI7ysVC5cdftqYWndw`
- カレンダーID: `16f6013dd3e06376074237fd9cf818e7287bb388ed28757e477058f90c97be52@group.calendar.google.com`
- 自動更新: ページ読み込み時に実行

## 使い方

### 1. 基本的な動作

ページを開くと、**自動的に**Googleカレンダーから予約済みの日時を取得し、カレンダー上で無効化（グレーアウト）します。

### 2. 動作確認方法

1. **ブラウザでページを開く**
   - `reserve.html`をブラウザで開く

2. **開発者ツールを開く**
   - `F12`キーを押す
   - 「コンソール」タブを選択

3. **ログを確認**
   - 以下のようなメッセージが表示されます:
     ```
     📅 Googleカレンダーから予約済み日時を取得中...
     ✅ 5件のイベントを取得しました
     📌 5件の予約済み時間帯を登録しました
     予約済み日時: { "2025-01-15": ["10:00", "14:00"], ... }
     ✅ カレンダーを更新しました
     ```

4. **カレンダーを確認**
   - 体験日時選択画面で、予約済みの日時が選択できない（グレーアウト）状態になっているか確認

### 3. 手動で更新する方法

ブラウザのコンソールで以下を実行:

```javascript
updateUnavailableTimes()
```

### 4. 定期更新を有効にする

5分ごとに自動更新する場合、`reserve.html`の以下の行のコメントを外してください:

```javascript
// 定期的に更新する場合（5分ごと）- 必要に応じてコメントを外す
setInterval(updateUnavailableTimes, 5 * 60 * 1000);
```

## 予約済み日時の表示方法

### カレンダー上での表示
- **選択可能な日付**: 通常の白背景
- **選択不可な日付**: グレーアウト（過去の日付や予約済みの日付）
- **今日の日付**: オレンジの枠線

### 時間選択での表示
- **選択可能な時間**: 通常の白背景ボタン
- **選択不可な時間**: グレーアウトボタン（クリック不可）

## よくある問題と解決方法

### ❌ CORSエラーが出る

**原因**: ブラウザのセキュリティ制限により、直接Google APIを呼び出せない場合があります。

**解決方法**:
1. **サーバーサイドプロキシを使用**（推奨）
   - バックエンドサーバーでAPIを呼び出し、フロントエンドに結果を返す
   - 詳細は `GOOGLE_CALENDAR_SETUP.md` を参照

2. **Google Cloud Consoleで設定**
   - API Keyの制限設定で、HTTPリファラーを追加
   - 例: `https://yourdomain.com/*`

### ❌ API Keyエラー

**エラーメッセージ**: `API key not valid`

**解決方法**:
1. Google Cloud ConsoleでAPI Keyが正しく設定されているか確認
2. Calendar APIが有効になっているか確認
3. API Keyの制限設定を確認

### ❌ カレンダーが見つからない

**エラーメッセージ**: `Calendar not found`

**解決方法**:
1. カレンダーIDが正しいか確認
2. カレンダーが公開設定になっているか確認（API Key使用時）
   - Googleカレンダー → カレンダーの設定 → 「このカレンダーを一般公開する」にチェック

### ❌ 予約済み日時が反映されない

**確認ポイント**:
1. コンソールでエラーが出ていないか確認
2. `updateUnavailableTimes()`を手動実行して確認
3. カレンダーのイベントが正しい形式（dateTime形式）か確認
4. イベントの開始時間が10:00～19:00の範囲内か確認

## テスト方法

### 1. テスト用のイベントを作成

Googleカレンダーで以下のようなイベントを作成:
- **日付**: 明日以降の日付
- **時間**: 10:00～19:00の範囲内
- **例**: 2025年1月20日 14:00～15:00

### 2. ページをリロード

`reserve.html`をリロード（F5キー）

### 3. 確認

- コンソールに「✅ X件のイベントを取得しました」と表示される
- カレンダーで2025年1月20日を選択
- 時間選択で14:00がグレーアウト（無効化）されている

## 現在の動作

✅ **自動実行**: ページ読み込み時に自動的に予約済み日時を取得
✅ **リアルタイム反映**: 取得したデータをカレンダーに反映
✅ **ログ出力**: コンソールで動作状況を確認可能

## 次のステップ

1. **動作確認**: 上記のテスト方法で動作を確認
2. **エラー対応**: エラーが出た場合は上記のトラブルシューティングを参照
3. **本番環境**: セキュリティのため、サーバーサイドプロキシの実装を検討

