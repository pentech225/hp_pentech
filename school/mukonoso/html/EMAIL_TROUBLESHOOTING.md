# メールが届かない場合のトラブルシューティング

## 📋 確認手順

### ステップ1: Google Apps Scriptのログを確認

1. **Google Apps Scriptのエディタを開く**
   - https://script.google.com/ にアクセス
   - プロジェクト「iTeen予約フォーム」を開く

2. **ログを確認**
   - 「表示」→「ログ」を開く
   - 予約フォームを送信した後に、以下のログを確認：
     - `📧 自動応答メール送信チェック開始`
     - `📧 確認メール送信先:`
     - `✅ 自動応答メール送信成功:` または `⚠️ 自動応答メールを送信しません:`

3. **エラーログを確認**
   - `❌ 自動応答メール送信エラー:` が表示されている場合、エラー内容を確認

### ステップ2: ブラウザのコンソールを確認

1. **開発者ツールを開く**
   - `F12`キーを押す
   - 「Console」タブを開く

2. **送信データを確認**
   - `📧 メール送信データ確認:` のログを確認
   - `replyTo`、`replySubject`、`replyBody`が正しく設定されているか確認

### ステップ3: Google Apps Scriptのコードが最新版か確認

1. **コードを確認**
   - Google Apps Scriptのエディタで、`handleReservationForm`関数を確認
   - `📧 自動応答メール送信チェック開始`というログが含まれているか確認

2. **再デプロイ**
   - コードが最新版でない場合：
     - 「デプロイ」→「管理デプロイ」を開く
     - デプロイを編集
     - 新しいバージョンとして再デプロイ

### ステップ4: メール送信の権限を確認

1. **権限の確認**
   - Google Apps Scriptのエディタで「実行」→「doPost」を選択
   - 「承認が必要です」という警告が表示されたら、承認する
   - Gmail送信の権限を許可する

2. **権限の再承認**
   - 「デプロイ」→「管理デプロイ」を開く
   - デプロイを編集
   - 「権限を確認」をクリック
   - 必要に応じて権限を再承認

## 🔍 よくある問題と解決方法

### 問題1: ログに「自動応答メールを送信しません」と表示される

**原因:**
- メールアドレスが設定されていない
- メールアドレスの形式が無効
- 件名や本文が設定されていない

**解決方法:**
- ログの`reason`フィールドを確認
- 原因に応じて修正

### 問題2: ログに「自動応答メール送信エラー」と表示される

**原因:**
- メール送信の権限が不足している
- メールアドレスの形式が無効
- Gmail送信の制限に達している

**解決方法:**
1. エラーメッセージを確認
2. 権限を再承認
3. メールアドレスの形式を確認

### 問題3: ログに何も表示されない

**原因:**
- Google Apps Script側のコードが最新版にデプロイされていない
- コードが実行されていない

**解決方法:**
1. Google Apps Scriptのエディタでコードを確認
2. 最新版がデプロイされているか確認
3. 必要に応じて再デプロイ

### 問題4: 管理者へのメールは届くが、確認メールが届かない

**原因:**
- 自動応答メールの送信処理でエラーが発生している
- メールアドレスの検証に失敗している

**解決方法:**
1. Google Apps Scriptのログを確認
2. エラーメッセージを確認
3. メールアドレスの形式を確認

## 📝 デバッグ用のログ出力

Google Apps Script側で以下のログが出力されます：

- `📧 自動応答メール送信チェック開始` - 処理開始
- `受信データ:` - 受信したデータの内容
- `✅ replyToからメールアドレスを取得:` - メールアドレスの取得成功
- `📧 確認メール送信先:` - 送信先メールアドレス
- `📧 メール送信準備完了:` - 送信準備完了
- `📧 メール送信を実行します:` - 送信実行
- `✅ 自動応答メール送信成功:` - 送信成功
- `⚠️ 自動応答メールを送信しません:` - 送信しない理由
- `❌ 自動応答メール送信エラー:` - エラー発生

## 🔄 次のステップ

1. **Google Apps Scriptのログを確認**
   - 上記のログが表示されているか確認
   - エラーメッセージがある場合は、内容を確認

2. **コードを再デプロイ**
   - 最新版のコードがデプロイされているか確認
   - 必要に応じて再デプロイ

3. **テスト送信**
   - メールアドレスを入力して予約フォームを送信
   - Google Apps Scriptのログで送信状況を確認

